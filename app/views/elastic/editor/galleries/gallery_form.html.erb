<script>
function get_the_indexes(){
  arr = $('.wakeThemeGallery > .active');
	arr = jQuery.map( arr, function(n,i){
		return( 'index[]='+$(n).attr('index') );
	});
	return arr.join('&');
}
</script>


<div class="wakeThemeCleanForm">

<% url = @item.new_record? ? {:action=>"create"} : {:action=>"update",:id=>@item.id } %>

<% if @file_record %>

	<h4>File record - Edit</h4>

	<%= form_for @file_record, :url=>f_update_editor_gallery_path(@item,@file_record.id) do |f| %>

		<%= f.text_field 'filename' %>
		<%= f.text_field 'title' %>
		<%= f.text_field 'id' %>
		
		<%= submit_tag 'OK'%>
    <%= link_to 'DOWNLOAD', f_edit_editor_gallery_path(@item,@file_record) %> 					  
		
	<% end %>
	<br/>

<% end %>


<%= form_for @item, :url=>url, :html => {:multipart => true} do |f| %>


	<%= f.text_field 'title', :value=>@item.title, :class=>'title' %> &nbsp; 
			
	<%= submit_tag 'OK', :class=>'button' %>
	<a href="#" class="button" onclick="">UPLOAD</a>
	<% path = f_destroy_editor_gallery_path(@item) %>
	<a href="#" class="button" onclick="if( confirm('<%= 'general.confirm_destroy' %>') ){ document.location = '<%=path%>' + '?' + get_the_indexes(); }">DESTROY</a>
	<%= link_to 'RESCAN', '' %>
	<%= link_to 'DUPLICATE', ''%>
	
	<div>
		<h4>File upload</h4>		
		<%= f.file_field 'file' %>
	</div>	
	
	<br/>

	<% if @item.new_record? %>
	<% else %>
		<% if not @item.non_images.empty? %>
			<div class="wakeThemeGallery">
				<% for fr in @item.file_records.non_images %>
				  <% extname = File.extname(fr.filename).upcase %>
				  <div class="fileItem" onclick="$(this).toggleClass('active');" index="<%= fr.id %>">
					  <%= link_to fr.filename.gsub(/\..*$/,''), f_edit_editor_gallery_path(@item,fr) %>
					  &nbsp;
  					<b><%= extname.gsub(/^\./,'') %></b>
					</div>
				<% end %>
				<div class="clear"></div>
			</div>
			
		<% end %>
	
		<% if not @item.images.empty? %>			
			<div class="wakeThemeGallery">
				<% for fr in @item.file_records.images %>
				  <div class="imageItem" onclick="$(this).toggleClass('active');" index="<%= fr.id %>">
						<img src="<%= fr.path('tna') %>" />
					  <%#= fr.path %>
					  <%#= fr.filename %> <%#= link_to 'show', fr.path('tna') %>
					</div>
				<% end %>
				<div class="clear"></div>
			</div>
		<% end %>
	<% end %>
	
	
	<br/>

	<div id="TheConfiguration" style="">
		<h4>Advanced configuration</h4>
		<table class="wakeThemeForm" class="">
			<tr>
				<th> Key: </th>
				<td> 
				  <%= f.text_field 'key', :size=>10, :class=>'' %> 
				  <%= f.check_box 'is_watermarked' %> <small>Watermarked?</small>
				</td>
			</tr>
			<%= render :partial=>'gallery_meta', :object=>f %>
	  </table>
	</div>

  <% end %>


<hr/>

<%=debug @item.files if not @item.new_record? %>


</div>
